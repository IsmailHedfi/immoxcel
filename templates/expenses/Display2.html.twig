{% extends 'base.html.twig' %}
{% block title %}
	All Transactions
{% endblock %}
{% block body %}
	<main
		class="main-content position-relative border-radius-lg">
		<!-- Navbar -->
		<nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" data-scroll="false">
			<div class="container-fluid py-1 px-3">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
						<li class="breadcrumb-item text-sm">
							<a class="opacity-5 text-white" href="javascript:;">Pages</a>
						</li>
						<li class="breadcrumb-item text-sm text-white active" aria-current="page">Tables</li>
					</ol>
					<h6 class="font-weight-bolder text-white mb-0">Tables</h6>
				</nav>
				<div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
					<div class="ms-md-auto pe-md-3 d-flex align-items-center">
						<div class="input-group">
							<span class="input-group-text text-body">
								<i class="fas fa-search" aria-hidden="true"></i>
							</span>
							<input type="text" class="form-control" placeholder="Type here...">
						</div>
					</div>
				</div>
			</div>
		</nav>
		<div
			class="container-fluid py-4">
			<!-- Error message -->
			{% if app.flashes('error')|length > 0 %}
				<div class="alert alert-danger alert-dismissible fade show" role="alert">
					<strong>Error:</strong>
					<p>You don't have any more money so you cannot pursue the purchase</p>
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			{% endif %}
			<!-- End Navbar -->
			<div class="container-fluid py-4">
				<div class="row">
					<div class="col-12">
						<div class="card mb-4">
							<div class="card-header pb-0">
								<h6>Supplier Table</h6>
								<div class="search-bar">
									<form class="search-form d-flex align-items-center" method="POST" action="#">
										<input type="text" name="query" placeholder="Search" title="Enter search keyword" id="search">
										<button type="submit" title="Search">
											<i class="bi bi-search"></i>
										</button>
									</form>
								</div>
								<!-- End Search Bar -->
								<select name="type" id="type" class="form-select" style="width:200px;">
									<option value="All">All</option>
									<option value="Income">Income</option>
									<option value="Expenses">Expenses</option>
									<option value="Salary">Salary</option>
								</select>
								<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
								<script>
									$(document).ready(function () { // Function to perform search
function searchExpenses() {
var query = $('input[name="query"]').val();
var type = $('select[name="type"]').val();
$.ajax({
url: "{{ path('expenses_search') }}",
type: "GET",
data: {
query: query,
type: type
},
success: function (response) { // Update the table with search results
$('.table tbody').html(response);
}
});
}

// Perform search on form submission
$('form.search-form').submit(function (event) {
event.preventDefault(); // Prevent form submission
searchExpenses();
});

// Perform search on type selection change
$('select[name="type"]').change(function () {
searchExpenses();
});
});
								</script>
							</div>
						</div>
						<div class="card-body px-0 pt-0 pb-2">
							<div class="table-responsive p-0">
								<table class="table align-items-center mb-0">
									<thead>
										<tr>
											<th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Id</th>
											<th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Type</th>
											<th class="text-center text-upperc ase text-secondary text-xxs font-weight-bolder opacity-7">QuantityE</th>
											<th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Coast</th>
											<th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Description</th>
											<th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Total Amount</th>
											<th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for p in expenses %}
											<tr>
												<td class="align-middle text-center text-sm">
													<span class="badge badge-sm bg-gradient-success">{{ p.Id }}</span>
												</td>
												<td class="align-middle text-center text-sm">
													<span class="text-secondary text-xs font-weight-bold">{{ p.Type }}</span>
												</td>
												<td class="align-middle text-center text-sm">
													<span class="text-secondary text-xs font-weight-bold">{{ p.QuantityE }}</span>
												</td>
												<td class="align-middle text-center">
													<span class="text-secondary text-xs font-weight-bold">{{ p.Coast }}</span>
												</td>
												<td class="align-middle">
													<span class="text-secondary text-xs font-weight-bold">{{ p.Description }}</span>
												</td>
												<td class="align-middle">
													<span class="text-secondary text-xs font-weight-bold">{{ p.TotalAmount }}</span>
												</td>
												<td class="align-middle">
													<div class="ms-auto text-end">
														<a class="btn btn-link text-dark px-3 mb-0" href="{{ path ('app_editTransaction', {'id':p.id}) }}">
															<i class="fas fa-pencil-alt text-dark me-2" aria-hidden="true"></i>Edit</a>
														<a class="btn btn-link text-dark px-3 mb-0" href="{{ path ('app_archive_expenses', {'id':p.id}) }}">
															<i class="fas fa-pencil-alt text-dark me-2" aria-hidden="true"></i>Arcihve</a>
														<a class="btn btn-link text-dark px-3 mb-0" href="{{ path('PDF_genrate', {'id': p.id}) }}">
															<i class="fas fa-file-pdf text-dark me-2" aria-hidden="true"></i>PDF
														</a>


													</div>
												</td>
											</tr>
										</tr>
									{% endfor %}
								</tbody>


							</table>

						</div>

					</div>
				</div>
			</div>
		</div>
	{% endblock %}
