<!DOCTYPE html>
<html>
<head>
    <title>Gmail API Quickstart</title>
    <meta charset="utf-8" />
</head>
<body>
<p>Gmail API Quickstart</p>

<!-- Add buttons to initiate auth sequence and sign out -->
<button id="authorize_button" onclick="handleAuthClick()">Authorize</button>
<button id="signout_button" onclick="handleSignoutClick()">Sign Out</button>

<pre id="content" style="white-space: pre-wrap;"></pre>

<form id="compose-form">
    <input type="text" id="compose-to" placeholder="To" required><br>
    <input type="text" id="compose-subject" placeholder="Subject"><br>
    <textarea id="compose-message" placeholder="Message" rows="5"></textarea><br>
    <button type="submit">Send</button>
</form>

<script type="text/javascript">
    /* exported gapiLoaded */
    /* exported gisLoaded */
    /* exported handleAuthClick */
    /* exported handleSignoutClick */
    /* exported handleComposeSubmit */

    // Your existing code...

    /**
     * Sends an email using the Gmail API.
     */
    async function sendEmail(to, subject, message) {
        try {
            const response = await gapi.client.gmail.users.messages.send({
                'userId': 'me',
                'resource': {
                    'raw': btoa(
                        'To: ' + to + '\r\n' +
                        'Subject: ' + subject + '\r\n\r\n' +
                        message
                    ).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '')
                }
            });
            console.log(response);
            alert('Email sent successfully!');
        } catch (error) {
            console.error('Error sending email:', error);
            alert('Failed to send email. Please check the console for error details.');
        }
    }

    /**
     * Handles form submission to compose and send an email.
     */
    document.getElementById('compose-form').addEventListener('submit', function (event) {
        event.preventDefault();
        const to = document.getElementById('compose-to').value;
        const subject = document.getElementById('compose-subject').value;
        const message = document.getElementById('compose-message').value;
        sendEmail(to, subject, message);
    });
</script>
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
